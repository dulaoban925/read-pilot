# ReadPilot Project Constitution

## Project Overview

ReadPilot 是一个基于 AI 的智能阅读助手，旨在通过先进的文档处理和智能分析技术，帮助用户更高效地阅读、理解和管理各类文档内容。

## Core Principles

### Principle 1: 隐私优先 (Privacy First)

**原则说明**：用户数据和阅读隐私是项目的第一优先级。所有用户产生的数据（包括阅读历史、笔记、标注、个人偏好等）必须默认本地存储，不得在未经用户明确授权的情况下上传到远程服务器。

**实施要求**：

- 默认数据存储方案必须是本地存储（SQLite、本地文件系统等）
- 如需使用云服务或第三方 API，必须：
  - 在首次使用前获得用户明确同意
  - 提供完全离线的备选方案
  - 清晰标注哪些功能需要联网
- 禁止收集用户行为数据用于分析，除非用户主动选择加入
- 所有敏感数据传输必须使用端到端加密

**违反后果**：任何违反此原则的功能默认不得合并，需经项目负责人审批并在复杂度追踪表中详细说明。

### Principle 2: 性能优先 (Performance First)

**原则说明**：响应速度直接影响用户体验。系统必须保证核心功能的快速响应，避免让用户等待。

**性能指标**：

- **文档处理**：文档加载和解析时间 < 2 秒（文件大小 < 50MB）
- **AI 功能响应**：智能摘要、问答等功能响应时间 < 3 秒
- **界面交互**：UI 操作响应延迟 < 100ms
- **内存占用**：常驻内存 < 500MB（不含缓存的文档内容）
- **启动时间**：应用冷启动时间 < 3 秒

**实施要求**：

- 在设计阶段必须考虑性能影响
- 使用流式处理处理大文件
- 实现智能缓存机制
- 对性能关键路径进行基准测试
- 避免阻塞主线程的操作

**监控机制**：每个新功能在代码审查时必须通过性能测试，不达标的功能需要优化后才能合并。

### Principle 3: 可扩展性 (Extensibility)

**原则说明**：系统架构必须支持模块化设计和插件系统，便于功能扩展和第三方开发者贡献。

**架构要求**：

- **插件系统**：核心功能与扩展功能明确分离
- **接口优先**：所有模块间交互通过明确定义的接口
- **文档格式支持**：新文档格式应可通过插件形式添加
- **AI 模型可替换**：支持切换不同的 AI 模型提供商
- **主题和样式可定制**：UI 主题系统支持第三方主题

**实施要求**：

- 使用依赖注入和事件驱动架构
- 提供完善的插件 API 文档
- 核心功能不依赖特定的第三方服务
- 支持配置文件热加载

**长期目标**：建立插件生态系统，让社区开发者可以贡献新功能。

### Principle 4: 可访问性 (Accessibility)

**原则说明**：软件应该是包容性的，为所有用户（包括残障人士）提供良好的使用体验。

**实施标准**：

- **键盘导航**：所有功能必须可通过键盘完成，不依赖鼠标
- **屏幕阅读器**：界面元素必须包含语义化标签，支持主流屏幕阅读器（NVDA、JAWS、VoiceOver）
- **视觉辅助**：
  - 支持高对比度模式
  - 字体大小可调节（最小 12px，最大 32px）
  - 颜色不作为唯一的信息传递方式
- **认知友好**：
  - 避免复杂的多步骤操作
  - 提供清晰的错误提示和操作反馈
  - 支持撤销/重做操作

**测试要求**：

- 每个新功能必须通过键盘导航测试
- 定期使用屏幕阅读器进行可访问性审计
- 遵循 WCAG 2.1 AA 级标准

### Principle 5: 简约设计 (Simplicity)

**原则说明**：界面和功能设计应遵循"少即是多"的原则，专注于核心阅读体验，避免功能堆砌。

**设计哲学**：

- **渐进式披露**：高级功能隐藏在菜单中，默认界面简洁
- **功能克制**：每个新功能提案必须回答"用户真的需要吗？"
- **零配置理念**：开箱即用，默认设置覆盖 80% 用户需求
- **减法思维**：定期审查和移除使用率低的功能

**实施要求**：

- 主界面核心操作不超过 5 个主按钮
- 设置选项分为"基础"和"高级"两个层级
- 使用智能默认值，减少用户决策负担
- 避免弹窗和打断式通知

**审查机制**：新功能提案需通过"必要性审查"，包括：

1. 目标用户群体和使用频率预估
2. 是否可与现有功能合并
3. 是否符合核心使用场景

---

## Additional Requirements & Constraints

### 技术栈约束

**前端**：

- 框架：React + TypeScript
- 构建工具：Vite
- 状态管理：优先使用 Context API，复杂状态可用 Zustand
- UI 库：优先使用无障碍友好的组件库（如 Radix UI、Headless UI）

**后端**：

- 语言：Python 3.12+（FastAPI）
- 数据库：SQLite（本地）+ PostgreSQL（可选云同步）
- AI 集成：支持本地模型（Ollama、llama.cpp）和云 API（OpenAI、Anthropic）

**文档处理**：

- PDF：PyMuPDF (fitz) 或 pdf.js
- EPUB：ebooklib
- DOCX：python-docx
- TXT/Markdown：原生解析

**部署**：

- 优先打包为桌面应用（Electron 或 Tauri）
- 提供 Web 版本作为备选方案
- Docker 镜像用于自托管部署

### 依赖管理策略

1. **库优先原则**：优先使用成熟的开源库，避免重复造轮子
2. **依赖审查**：新增依赖必须评估：
   - 维护状态（最近 6 个月有更新）
   - 许可证兼容性（MIT、Apache 2.0、BSD）
   - 包大小（前端依赖 < 500KB）
   - 安全记录（无已知高危漏洞）
3. **最小依赖**：定期审查并移除未使用的依赖

### 安全要求

- **输入验证**：所有用户输入和文件上传必须验证
- **依赖更新**：每月检查并更新依赖的安全补丁
- **代码扫描**：使用 Snyk 或 Dependabot 进行自动化安全扫描
- **API 密钥管理**：使用环境变量，不允许硬编码

### 许可证

本项目采用 **MIT License**，允许商业使用和二次开发。

---

## Process & Workflow Guidelines

### 开发流程

1. **功能提案** → 2. **规格说明** → 3. **技术方案** → 4. **任务拆解** → 5. **实现与测试** → 6. **代码审查** → 7. **合并发布**

### 代码审查标准

**必须检查项**：

- [ ] 功能符合规格说明（spec.md）
- [ ] 通过所有单元测试和集成测试
- [ ] 性能指标达标（参考 Principle 2）
- [ ] 可访问性测试通过（参考 Principle 4）
- [ ] 代码风格一致（使用 ESLint/Prettier 或 Black/Ruff）
- [ ] 无新增的高危依赖
- [ ] 文档已更新（如有 API 变更）

**代码审查权限**：

- 核心功能变更：需至少 2 名核心贡献者批准
- 性能优化和 Bug 修复：需 1 名核心贡献者批准
- 文档和样式调整：可直接合并（需 CI 通过）

### 测试策略

**测试金字塔**：

- **单元测试**（70%）：覆盖所有核心业务逻辑
- **集成测试**（20%）：测试模块间交互
- **端到端测试**（10%）：覆盖关键用户流程

**测试要求**：

- 新功能代码覆盖率 ≥ 80%
- 核心功能回归测试必须通过
- 性能基准测试作为 CI/CD 的一部分

**测试工具**：

- 前端：Vitest + React Testing Library
- 后端：pytest 或 Jest
- E2E：Playwright

### 版本发布

**语义化版本**（Semantic Versioning）：

- **主版本号（Major）**：不兼容的 API 变更
- **次版本号（Minor）**：向后兼容的新功能
- **修订号（Patch）**：向后兼容的问题修复

**发布周期**：

- 稳定版本：每 4-6 周发布一次
- 补丁版本：�� 据需要随时发布
- Beta 版本：新功能在 Beta 版本中测试至少 2 周

---

## Governance Rules

### 宪章权威性

1. **最高优先级**：本宪章是项目的最高决策依据，所有技术决策必须符合宪章原则。
2. **强制遵守**：任何违反宪章的代码不得合并到主分支。
3. **透明追踪**：如因技术限制必须违反宪章，需在技术方案（plan.md）的"复杂度追踪表"中记录，并说明：
   - 违反了哪条原则
   - 违反的合理性分析
   - 替代方案评估
   - 风险缓解措施
   - 审批状态（待审批/已批准/已拒绝）

### 宪章修订流程

**修订触发条件**：

- 技术栈发生重大变化（如迁移框架）
- 多个功能反复违反同一原则
- 社区提出合理的改进建议

**修订流程**：

1. 提出修订提案（包含修改原因和影响分析）
2. 社区讨论期（至少 1 周）
3. 核心团队投票（需 2/3 多数通过）
4. 更新宪章并通知所有贡献者
5. 修订历史记录在 changelog 中

**修订原则**：

- 核心原则（Principles 1-5）不得轻易修改
- 技术栈约束可根据技术演进适度调整
- 修订不得降低现有的质量标准

### 合规要求

**数据隐私合规**：

- 如产品面向欧盟用户，需符合 GDPR
- 如面向中国用户，需符合《个人信息保护法》
- 提供数据导出和删除功能

**开源协议合规**：

- 所有依赖的许可证必须与 MIT License 兼容
- 禁止使用 GPL 或 AGPL 许可的库（除非作为可选插件）

**无障碍合规**：

- 遵循 WCAG 2.1 AA 级标准
- 在美国/欧盟市场发布时需通过无障碍认证

---

## Enforcement & Accountability

**宪章检查点**：

1. **规格评审**（/speckit.specify 之后）：检查功能是否符合宪章精神
2. **技术方案评审**（/speckit.plan 之后）：自动检查技术选型是否违反宪章
3. **代码审查**（Pull Request）：人工审查实现是否符合宪章要求
4. **发布前审计**：确保发布版本符合所有宪章标准

**责任归属**：

- **项目负责人**：负责宪章解释和重大违规决策
- **核心贡献者**：负责日常代码审查中的宪章执行
- **所有贡献者**：提交代码前自查是否符合宪章

**违规处理**：

- **轻微违规**（如性能略低于标准）：要求优化后合并
- **严重违规**（如违反隐私原则）：拒绝合并并要求重新设计
- **多次违规**：暂停该贡献者的合并权限，直至理解宪章要求

---

## Document History

| 版本 | 日期       | 修改内容     | 修改人    |
| ---- | ---------- | ------------ | --------- |
| 1.0  | 2025-10-21 | 初始版本创建 | Claude AI |

---

**本宪章自发布之日起生效，适用于 ReadPilot 项目的所有开发活动。**
